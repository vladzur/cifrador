<?php
use \Vladzur\Cifrador\Cifrador;

/**
 * Created by vladzur.
 * Date: 21-12-15
 * Time: 19:20
 */
class CifradorTest extends PHPUnit_Framework_TestCase
{

    public function test_encrypt_text()
    {
        $cypher = new Cifrador();
        $text = "Hola Mundo";
        $encrypted = $cypher->encrypt($text, 's3cr3tp4ssw0rd');
        return $this->assertFalse($text === $encrypted);
    }

    public function test_decrypt_text()
    {
        $cypher = new Cifrador();
        $text = "This is a secret message";
        $encrypted = $cypher->encrypt($text, 's3cr3tp4ssw0rd');
        $decrypted_text = $cypher->decrypt($encrypted, 's3cr3tp4ssw0rd');
        return $this->assertEquals($text, $decrypted_text);
    }

    public function test_wrong_password()
    {
        $cypher = new Cifrador();
        $text = "This is a secret message";
        $encrypted = $cypher->encrypt($text, 's3cr3tp4ssw0rd');
        $decrypted_text = $cypher->decrypt($encrypted, 'secr3tp4ssw0rd');
        return $this->assertFalse($text == $decrypted_text);
    }

    public function test_encrypt_long_text()
    {
        $text = "ClZsYWR6dXIgQmxvZwoKVW4gYmxvZyBzb2JyZSBwcm9ncmFtYWNpw7NuLCBsbGVubyBkZSBleHBlcmllbmNpYXMgcGVyc29uYWxlcwpBdXRvbWF0aXphbmRvIGFzc2V0cyBjb24gTGFyYXZlbCBFbGl4aXIKCkRlYyAxOSwgMjAxNVZsYWRpbWlyIFp1cml0YQoKTGFyYXZlbCB0aWVuZSB1bmEgQVBJIGxsYW1hZGEgRWxpeGlyIHBhcmEgcG9kZXIgZWplY3V0YXIgdGFyZWFzIGNvbiBHdWxwLCBkZSBlc3RhIG1hbmVyYSBmYWNpbGl0YSBtdWNobyBsYXMgY29zYXMgYSBsYSBob3JhIGRlIG1hbmVqYXIgbnVlc3Ryb3MgYXNzZXRzIHkgbG9zIHRlc3QuCgpMbyBwcmltZXJvIHF1ZSBuZWNlc2l0YW1vcyBlcyBub2RlLCBlcyB1bmEgaW5zdGFsYWNpw7NuIGbDoWNpbCBkZSByZWFsaXphciBzaWd1aWVuZG8gbGFzIGluc3J1Y2Npb25lcyBlbiBOb2RlSlMKCllvIHByZWZpZXJvIHVzYXIgYm93ZXIgcGFyYSBsYSBpbnN0YWxhY2nDs24gZGUgZGVwZW5kZW5jaWFzIGRlIGxhIGFwbGljYWNpw7NuIHF1ZSBlc3RhbW9zIGNyZWFuZG8sIGNvbW8gQm9vdHN0cmFwIHkgalF1ZXJ5IHkgbnBtIHBhcmEgbGFzIGRlcGVuZGVuY2lhcyBwcm9waWFzIGRlbCBzaXN0ZW1hLCBjb21vIHBvciBlamVtcGxvIEd1bHAgeSBFbGl4aXIuCgpQYXJhIGluc3RsYXIgYm93ZXIsIGRlYmVtb3MgZWplY3V0YXIKCiQgbnBtIGluc3RhbGwgLWcgYm93ZXIKCkVuIGNhc28gZGUgdGVuZXIgZXJyb3JlcyBkZSBwZXJtaXNvcywgc2UgZGViZSBlamVjdXRhciBlbCBjb21hbmRvIGNvbW8gc3VkbwoKQSBjb250aW51YWNpw7NuIGluc3RhbGFyZW1vcyBHdWxwCgokIG5wbSBpbnN0YWxsIGd1bHAgLWcKCkVuIGNhc28gZGUgdGVuZXIgZXJyb3JlcyBkZSBwZXJtaXNvcywgc2UgZGViZSBlamVjdXRhciBlbCBjb21hbmRvIGNvbW8gc3VkbwoKQWhvcmEgZW4gbGEgcmHDrXogZGUgbnVlc3RybyBwcm95ZWN0byBsYXJhdmVsLCBlamVjdXRhcmVtb3MKCiQgbnBtIGluc3RhbGwKCkVzdG8gdmEgYSBpbnN0YWxhciB0b2RhcyBsYXMgZGVwZW5kZW5pYXMgbmVjZXNhcmlhcyBlbiBlbCBkaXJlY3RvcmlvIG5vZGVfbW9kdWxlcy4KU2NyaXB0cwoKQWhvcmEgdmFtb3MgYSBsbyBpbXBvcnRhbnRlLiBOZWNlc2l0YW1vcyB1c2FyIGpRdWVyeSB5IEJvb3RzdHJhcCBlbiBudWVzdHJvIHByb3llY3RvLCBwYXJhIGVzbyB2YW1vcyBhIHVzYXIgYm93ZXIgeSBkZWJlbW9zIGluaWNpYWxpemFybG8uCgokIGJvd2VyIGluaXQKClVuYSB2ZXogaW5pY2lhbGl6YWRvLCBib3dlciBjcmVhIHVuIGFyY2hpdm8gbGxhbWFkbyBib3dlci5qc29uIGFob3JhIHZhbW9zIGEgaW5zdGFsYXIgbnVlc3RyYXMgZGVwZW5kZW5jaWFzCgokIGJvd2VyIGluc3RhbGwganF1ZXJ5IGJvb3RzdHJhcCAtLXNhdmUKCkJvd2VyIGluc3RhbMOzIGxvcyBwYXF1ZXRlcyByZXF1ZXJpZG9zIGVuIGVsIGRpcmVjdG9yaW8gYm93ZXJfY29tcG9uZW50cyB5IGxvcyBhZ3JlZ8OzIGNvbW8gZGVwZW5kZW5jaWFzIGVuIGVsIGFyY2hpdm8gYm93ZXIuanNvbiwgYXPDrSBjdWFuZG8gb3Ryb3MgY29sYWJvcmFkb3JlcyBkZWwgcHJveWVjdG8gbmVjZXNpdGVuIGluc3RhbGFyIGxhcyBkZXBlbmRlbmNpYXMgcXVlIGluZGljYW1vcywgc8OzbG8gZGJlbiBlamVjdXRhcgoKJCBib3dlciBpbnN0YWxsCgpBaG9yYSB2YW1vcyBhIGdlbmVyYXIgbGEgdGFyZWEgcXVlIHNlIGVuY2FyZ2Fyw6EgZGUgdW5pciBudWVzdHJhcyBkZXBlbmRlbmNpYXMgZW4gdW4gc29sbyBhcmNoaXZvIGpzIHkgZW4gdW4gc29sbyBhcmNoaXZvIGNzcyBwYXJhIHF1ZSBzZWEgdXNhZG8gcG9yIG51ZXN0cmEgYXBsaWNhY2nDs24uCgpOZWNlc2l0YW1vcyBlZGl0YXIgZWwgYXJjaGl2byBndWxwZmlsZS5qcyBxdWUgZXN0w6EgZW4gbGEgcmHDrXogZGVsIHByb3llY3RvCgp2YXIgZWxpeGlyID0gcmVxdWlyZSgnbGFyYXZlbC1lbGl4aXInKTsKCi8qCiB8LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIHwgRWxpeGlyIEFzc2V0IE1hbmFnZW1lbnQKIHwtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogfAogfCBFbGl4aXIgcHJvdmlkZXMgYSBjbGVhbiwgZmx1ZW50IEFQSSBmb3IgZGVmaW5pbmcgc29tZSBiYXNpYyBHdWxwIHRhc2tzCiB8IGZvciB5b3VyIExhcmF2ZWwgYXBwbGljYXRpb24uIEJ5IGRlZmF1bHQsIHdlIGFyZSBjb21waWxpbmcgdGhlIFNhc3MKIHwgZmlsZSBmb3Igb3VyIGFwcGxpY2F0aW9uLCBhcyB3ZWxsIGFzIHB1Ymxpc2hpbmcgdmVuZG9yIHJlc291cmNlcy4KIHwKICovCgplbGl4aXIoZnVuY3Rpb24obWl4KSB7CiAgICBtaXguc2FzcygnYXBwLnNjc3MnKQp9KTsKClBhcmEgbnVlc3RybyBjYXNvLCB2YW1vcyBhIHVzYXIgbGVzcyBwYXJhIGdlbmVyYXIgbnVlc3RybyBjc3MKCmVsaXhpcihmdW5jdGlvbihtaXgpIHsKICAgIG1peC5sZXNzKCdhcHAubGVzcycpCn0pOwoKVmFtb3MgYSBlc2NyaWJpciBlbiBlbCBhcmNoaXZvIHJlc291cmNlcy9hc3NldHMvbGVzcy9hcHAubGVzcyBsbyBzaWd1aWVudGU6CgpAaW1wb3J0ICJib3dlcl9jb21wb25lbnRzL2Jvb3RzdHJhcC9sZXNzL2Jvb3RzdHJhcC5sZXNzIjsKCkFkZW3DoXMgdmFtb3MgYSBnZW5lcmFyIGVsIGFyY2hpdm8gamF2YXNjcmlwdCBkZSBudWVzdHJhIGFwbGljYWNpw7NuIHkgZXN0ZSB2YSBhIGNvbnRlbmVyIGEgalF1ZXJ5IHkgYm9vdHN0cmFwCgplbGl4aXIoZnVuY3Rpb24obWl4KSB7CiAgICBtaXgubGVzcygnYXBwLmxlc3MnKQogICAgICAgIC5zY3JpcHRzKFsKICAgICAgICAgICAgJ2pxdWVyeS9kaXN0L2pxdWVyeS5qcycsCiAgICAgICAgICAgICdib290c3RyYXAvZGlzdC9qcy9ib290c3RyYXAuanMnCiAgICAgICAgXSwgJ3B1YmxpYy9qcy9hcHAuanMnLCAnYm93ZXJfY29tcG9uZW50cycpCn0pOwoKRXN0byB2YSBhIGJ1c2NhciBsYXMgZGVwZW5kZW5jaWFzIGRlbnRybyBkZWwgZGlyZWN0b3JpbyBib3dlcl9jb21wb25lbnRzIGxhcyBqdW50YXLDoSBlbiB1biBzb2xvIGFyY2hpdm8gbGxtYWRvIGFwcC5qcyBlbCBxdWUgcXVlZGFyw6EgZW4gcHVibGljL2pzCgpUYW1iacOpbiB2YW1vcyBhIGNvcGlhciBsYXMgdGlwb2dyYWbDrWFzIGRlIGJvb3RzdHJhcCBhIHVuIGRpcmVjdG9yaW8gcMO6YmxpY28gcGFyYSBxdWUgcHVlZGEgc2VyIGFjY2VkaWRhIHBvciBsYSBhcGxpY2FjacOzbgoKZWxpeGlyKGZ1bmN0aW9uKG1peCkgewogICAgbWl4Lmxlc3MoJ2FwcC5sZXNzJykKICAgICAgICAuc2NyaXB0cyhbCiAgICAgICAgICAgICdqcXVlcnkvZGlzdC9qcXVlcnkuanMnLAogICAgICAgICAgICAnYm9vdHN0cmFwL2Rpc3QvanMvYm9vdHN0cmFwLmpzJwogICAgICAgIF0sICdwdWJsaWMvanMvYXBwLmpzJywgJ2Jvd2VyX2NvbXBvbmVudHMnKQogICAgICAgIC5jb3B5KCdib3dlcl9jb21wb25lbnRzL2Jvb3RzdHJhcC9kaXN0L2ZvbnRzLycsICdwdWJsaWMvZm9udHMvYm9vdHN0cmFwLycpCn0pOwoKQWhvcmEgc8OzbG8gbm9zIHF1ZWRhIGVqZWN1dGFyIEd1bHAgcGFyYSBxdWUgbGEgbWFnaWEgc2UgaGFnYS4KCiQgZ3VscAoKRXN0byB2YSBhIGNvbWJpbmFyIG51ZXN0cm8gYXJjaGl2byBhcHAubGVzcyBlbiBwdWJsaWMvY3NzL2FwcC5jc3MgeSBjcmVhcsOhIHB1YmxpYy9qcy9hcHAuanMgY29udGVuaWVuZG8gbGFzIGJpYmxpb3RlY2FzIHF1ZSBpbmRpY2Ftb3MuIEFkZW3DoXMgbGFzIHRpcG9ncmFmw61hcyBkZSBib290c3RyYXAgc2UgdmFuIGEgY29waWFyIGEgcHVibGljL2ZvbnRzL2Jvb3RzdHJhcC4KClBhcmEgZmluYWxpemFyLCBwb2RlbW9zIGhhY2VyIHF1ZSBudWVzdHJvcyBhcHAuanMgeSBhcHAuY3NzIHF1ZWRlbiBtaW5pZmljYWRvcyBjb24gZWwgbW9kaWZpY2Fkb3IgLS1wcm9kdWN0aW9uCgokIGd1bHAgLS1wcm9kdWN0aW9uCgpFc28gZXMgdG9kbyBwb3IgYWhvcmEsIHlhIHB1ZWRlcyBhdXRvbWF0aXphciB0dXMgYXNzZXRzIHNlZ8O6biB0dXMgbmVjZXNpZGFkZXMuCgpDw7NtbyB1c2FyIERlcGxveWVyIGNvbiBMYXJhdmVsIDUuMQoKRGVjIDE3LCAyMDE1VmxhZGltaXIgWnVyaXRhCgpEZXBsb3llciBlcyB1bmEgaGVycmFtaWVudGEgcGFyYSBpbnN0YWxhciBhcGxpY2FjaW9uZXMgZXNjcml0YSBlbiBQSFAgcG9yIGxvIHF1ZSBtZSBwYXJlY2UgbcOhcyBhcHJvcGlhZGEgcXVlIENhcGlzdHJhbm8gYSBsYSBob3JhIGRlIGluc3RhbGFyIGFwbGljYWNpb25lcyBlc2NyaXRhcyBlbiBQSFAuCgpMYSBpbnN0YWxhY2nDs24gZGUgRGVwbG95ZXIgc2UgcHVlZGUgaGFjZXIgYSBuaXZlbCBnbG9iYWwgKHlvIGxvIHJlY29taWVuZG8pIG8gY29tbyBkZXBlbmRlbmNpYSB1c2FuZG8gY29tcG9zZXIuCgpJbnN0YWxhY2nDs24gZ2xvYmFsCgokIHdnZXQgaHR0cDovL2RlcGxveWVyLm9yZy9kZXBsb3llci5waGFyCiQgc3VkbyBtdiBkZXBsb3llci5waGFyIC91c3IvbG9jYWwvYmluL2RlcAokIHN1ZG8gY2htb2QgK3ggL3Vzci9sb2NhbC9iaW4vZGVwCgpVc2FuZG8gY29tcG9zZXIKCmNvbXBvc2VyIHJlcXVpcmUgZGVwbG95ZXIvZGVwbG95ZXI6XjMuMAoKUGFyYSB1c2FyIGRlcGxveWVyIGhheSBxdWUgY3JlYXIgdW4gYXJjaGl2byBlbiBsYSByYcOteiBkZWwgcHJveWVjdG8gY29uIGVsIG5vbWJyZSBkZXBsb3kucGhwCgpFc3RlIGVzIGVsIGFyY2hpdm8gZGVwbG95LnBocCBxdWUgc2UgdXNhIHBhcmEgaGFjZXIgZGVwbG95IGRlIGVzdGUgYmxvZyAobGEgaW1mb3JtYWNpw7NuIHNlbnNpYmxlIHNlIGhhIHJlbW92aWRvKQoKPD9waHAKCnJlcXVpcmUgJ3JlY2lwZS9jb21tb24ucGhwJzsKCi8vIExhcmF2ZWwgNSBzaGFyZWQgZmlsZQpzZXQoJ3NoYXJlZF9maWxlcycsIFsnLmVudiddKTsKCi8vIExhcmF2ZWwgd3JpdGFibGUgZGlycwpzZXQoJ3dyaXRhYmxlX2RpcnMnLCBbJ3N0b3JhZ2UnLCAndmVuZG9yJywgJ2Jvb3RzdHJhcC9jYWNoZSddKTsKCnRhc2soJ2RhdGFiYXNlOm1pZ3JhdGUnLCBmdW5jdGlvbiAoKSB7CiAgICBydW4oInBocCBjdXJyZW50L2FydGlzYW4gbWlncmF0ZSIpOwp9KTsKCi8qKgogKiBVcGRhdGluZyBjb21wb3NlciB0YXNrcy4KICovCnRhc2soJ2RlcGxveTp1cGRhdGVfY29tcG9zZXInLCBmdW5jdGlvbiAoKSB7CiAgICBpZiAoY29tbWFuZEV4aXN0KCdjb21wb3NlcicpKSB7CiAgICAgICAgJGNvbXBvc2VyID0gJ2NvbXBvc2VyJzsKICAgIH0gZWxzZSB7CiAgICAgICAgcnVuKCJjZCB7e3JlbGVhc2VfcGF0aH19ICYmIGN1cmwgLXNTIGh0dHBzOi8vZ2V0Y29tcG9zZXIub3JnL2luc3RhbGxlciB8IHBocCIpOwogICAgICAgICRjb21wb3NlciA9ICdwaHAgY29tcG9zZXIucGhhcic7CiAgICB9CgogICAgJGNvbXBvc2VyRW52VmFycyA9IGVudignZW52X3ZhcnMnKSA/ICdleHBvcnQgJyAuIGVudignZW52X3ZhcnMnKSAuICcgJiYnIDogJyc7CiAgICBydW4oImNkIHt7cmVsZWFzZV9wYXRofX0gJiYgJGNvbXBvc2VyRW52VmFycyAkY29tcG9zZXIgdXBkYXRlIik7Cgp9KS0+ZGVzYygnSW5zdGFsbGluZyB2ZW5kb3JzJyk7Cgp0YXNrKCdhcnRpc2FuOmNsZWFyJywgZnVuY3Rpb24gKCkgewogICAgcnVuKCJjZCB7e3JlbGVhc2VfcGF0aH19ICYmIHBocCBhcnRpc2FuIGNhY2hlOmNsZWFyIik7Cn0pLT5kZXNjKCdDbGVhbmluZyBsYXJhdmVsIGNhY2hlJyk7CgovKioKICogTWFpbiB0YXNrCiAqLwp0YXNrKCdkZXBsb3knLCBbCiAgICAnZGVwbG95OnByZXBhcmUnLAogICAgJ2RlcGxveTpyZWxlYXNlJywKICAgICdkZXBsb3k6dXBkYXRlX2NvZGUnLAogICAgJ2RlcGxveTp2ZW5kb3JzJywKICAgICdkZXBsb3k6c2hhcmVkJywKICAgICdhcnRpc2FuOmNsZWFyJywKICAgICdkZXBsb3k6d3JpdGFibGUnLAogICAgJ2RlcGxveTp1cGRhdGVfY29tcG9zZXInLAogICAgJ2RlcGxveTpzeW1saW5rJywKICAgICdjbGVhbnVwJywKXSktPmRlc2MoJ0RlcGxveSB5b3VyIHByb2plY3QnKTsKCmFmdGVyKCdkZXBsb3knLCAnc3VjY2VzcycpOwoKc2VydmVyKCdwcm9kJywgJ3NlcnZpZG9yLmNvbScsIDIyKQogICAgLT51c2VyKCdyb290JykKICAgIC0+cGFzc3dvcmQobnVsbCkKICAgIC0+c3RhZ2UoJ3Byb2R1Y3Rpb24nKQogICAgLT5lbnYoJ2RlcGxveV9wYXRoJywgJy9wYXRoL3RvL3dlYi9hcHBsaWNhdGlvbicpOwoKZW52KCdicmFuY2gnLCBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gYXNrKCdFbnRlciBicmFuY2ggdG8gZGVwbG95JywgZ2V0X2N1cnJlbnRfZ2l0X2NvbW1pdCgpKTsKfSk7CgpzZXQoJ3JlcG9zaXRvcnknLCAnZ2l0QGdpdGh1Yi5jb206Y3VlbnRhL3JlcG9zaXRvcmlvLmdpdCcpOwoKZnVuY3Rpb24gZ2V0X2N1cnJlbnRfZ2l0X2NvbW1pdCgpCnsKICAgIHJldHVybiB0cmltKGltcGxvZGUoJy8nLCBhcnJheV9zbGljZShleHBsb2RlKCcvJywgZmlsZV9nZXRfY29udGVudHMoJy5naXQvSEVBRCcpKSwgMikpKTsKfQoKUGFyYSBwb2RlciBoYWNlciBkZXBsb3kgKGluc3RhbGFyKSBsYSBhcGxpY2FjacOzbiBlbiBlbCBzZXJ2aWRvciwgc2UgZGViZSBlamVjdXRhciBlbCBjb21hbmRvCgokIGRlcCBkZXBsb3kgcHJvZHVjdGlvbgoKVG9kYSBsYSBpbmZvcm1hY2nDs24gYWNlcmNhIGRlIERlcGxveWVyIHNlIHB1ZWRlIGVuY29udHJhciBlbiBodHRwOi8vZGVwbG95ZXIub3JnL2RvY3MKCklueWVjY2nDs24gZGUgZGVwZW5kZW5jaWFzIGVuIFBIUAoKRGVjIDE3LCAyMDE1VmxhZGltaXIgWnVyaXRhCgpQYXJhIGVudGVuZGVyIGPDs21vIGZ1bmNpb25hIGxhIGlueWVjY2nDs24gZGUgZGVwZW5kZW5jaWFzIGVuIFBIUCwgdmVyZW1vcyB1biBlamVtcGxvLgoKVGVuZW1vcyBsYSBzaWd1aWVudGUgY2xhc2U6CgpjbGFzcyBVc3VhcmlvCnsKICAgIHB1YmxpYyAkbm9tYnJlOwogICAgcHVibGljICRlbWFpbDsKCiAgICBwdWJsaWMgZnVuY3Rpb24gX19jb25zdHJ1Y3QoJG5vbWJyZSwgJGVtYWlsKQogICAgewogICAgICAgICR0aGlzLT5ub21icmUgPSAkbm9tYnJlOwogICAgICAgICR0aGlzLT5lbWFpbCA9ICRlbWFpbDsKICAgIH0KfQoKY2xhc3MgQXJ0aWN1bG8KewogICAgcHVibGljICR0aXR1bG87CiAgICBwdWJsaWMgJGNvbnRlbmlkbzsKICAgIHB1YmxpYyAkYXV0b3I7CgogICAgcHVibGljIGZ1bmN0aW9uIF9fY29uc3RydWN0KCR0aXR1bG8sICRjb250ZW5pZG8sICRub21icmUsICRlbWFpbCkKICAgIHsgICAgICAgCiAgICAgICAgJHRoaXMtPnRpdHVsbyA9ICR0aXR1bG87CiAgICAgICAgJHRoaXMtPmNvbnRlbmlkbyA9ICRjb250ZW5pZG87CiAgICAgICAgJHRoaXMtPmF1dG9yID0gbmV3IFVzdWFyaW8oJG5vbWJyZSwgJGVtYWlsKTsKICAgIH0gICAgICAgCn0KClBvZGVtb3MgZGVmaW5pciB1biBudWV2byBhcnTDrWN1bG8gZsOhY2lsbWVudGU6CgokYXJ0aWN1bG8gPSBuZXcgQXJ0aWN1bG8oJ2V4dHJhJywgJ2NvbnRlbmlkbyBkZWwgYXJ0aWN1bG8nLCAnTWkgTm9tYnJlJywgJ3lvQGRvbWluaW8uY29tJyk7CgpBbCBwYXJlY2VyIHRvZG8gYmllbiwgcGVybyDCv3F1w6kgaGFjZW4gbG9zIGRhdG9zIGRlbCB1c3VhcmlvIGVuIGxhIGNsYXNlIGRlIGxvcyBhcnTDrWN1bG9zPy4KClBhcmEgZXZpdGFyIGVzdGEgbWFsYSBwcsOhY3RpY2EsIHBvZGVtb3MgaW55ZWN0YXIgZWwgb2JqZXRvIHVzdWFyaW8gZW4gbnVlc3RyYSBjbGFzZSBkZSBhcnRpY3Vsb3MgY29tbyB1bmEgZGVwZW5kZW5jaWEuCgpjbGFzcyBBcnRpY3Vsbwp7CiAgICBwdWJsaWMgJHRpdHVsbzsKICAgIHB1YmxpYyAkY29udGVuaWRvOwogICAgcHVibGljICRhdXRvcjsKCiAgICBwdWJsaWMgZnVuY3Rpb24gX19jb25zdHJ1Y3QoJHRpdHVsbywgJGNvbnRlbmlkbywgVXN1YXJpbyAkdXN1YXJpbykKICAgIHsgICAgICAgCiAgICAgICAgJHRoaXMtPnRpdHVsbyA9ICR0aXR1bG87CiAgICAgICAgJHRoaXMtPmNvbnRlbmlkbyA9ICRjb250ZW5pZG87CiAgICAgICAgJHRoaXMtPmF1dG9yID0gJHVzdWFyaW87CiAgICB9ICAgICAgIAp9CgpBaG9yYSBwb2RlbW9zIGNyZWFyIHVuIGFydMOtY3VsbwoKJHVzdWFyaW8gPSBuZXcgVXN1YXJpbygnTWkgTm9tYnJlJywgJ3lvQGRvbWluaW8uY29tJyk7CiRhcnRpY3VsbyA9IG5ldyBBcnRpY3VsbG8oJ01pIFRpdHVsbycsICdFbCBjb250ZW5pZG8nLCAkdXN1YXJpbyk7CgpDb24gZXN0byBwb2RlbW9zIGV2aXRhciBxdWUgbnVlc3RyYXMgY2xhc2VzIHRlbmdhbiByZXNwb25zYWJpbGlkYWRlcyBxdWUgbm8gbGVzIGNvcnJlc3BvbmRlbiB5IGVzdG8gZXMgc3VtYW1lbnRlIGltcG9ydGFudGUgYSBsYSBob3JhIGRlIGVzY2FsYXIgdW5hIGFwbGljYWNpw7NuLgoKUG9yIGVqZW1wbG86IG5lY2VzaXRhbW9zIG9wZXJhciBudWVzdHJhIGN1ZW50YSBkZSBiYW5jbyB1c2FuZG8gZWwgc2VydmljaW8gcXVlIHByb3ZlZSBlbCBiYW5jby4KCmNsYXNzIE1pQmFuY28gCnsKCiAgICBwdWJsaWMgZnVuY3Rpb24gaGFjZXJHaXJvKCRtb250bykKICAgIHsKICAgICAgICAkYmNpID0gbmV3IEJjaVNlcnZpY2UoKTsKICAgICAgICAkYmNpLT5naXJhcigkbW9udG8pOwogICAgICAgIHJldHVybiAkYmNpLT5nZXRTYWxkbygpOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBoYWNlckRlcG9zaXRvKCRtb250bykKICAgIHsKICAgICAgICAkYmNpID0gbmV3IEJjaVNlcnZpY2UoKTsKICAgICAgICAkYmNpLT5kZXBvc2l0YXIoJG1vbnRvKTsKICAgICAgICByZXR1cm4gJGJjaS0+Z2V0U2FsZG8oKTsKICAgIH0KfQoKJG1pQmFuY28gPSBuZXcgTWlCYW5jbygpOwokbWlCYW5jby0+aGFjZXJEZXBvc2l0bygxMDAwKTsKJG1pQmFuY28tPmhhY2VyR2lybyg0MDApOwoKUGVybyDCv3F1w6kgcGFzYSBzaSBjYW1iaWFtb3MgZGUgYmFuY28/LCB0ZW5kcsOtYW1vcyBxdWUgbW9kaWZpY2FyIG51ZXN0cm8gY8OzZGlnbyBwYXJhIGFkYXB0YXJsbyBhbCBudWV2byBzZXJ2aWNpbyBkZWwgYmFuY28uCgpQYXJhIGV2aXRhciBlc3RvLCBwb2RlbW9zIGlueWVjdGFyIGVsIHNlcnZpY2lvIGRlbCBiYW5jbyBjb21vIHVuYSBkZXBlbmRlbmNpYSBlbiBudWVzdHJhIGNsYXNlLCBwYXJhIGVzbyBwb2RlbW9zIHVzYXIgdW5hIGludGVyZmF6IHF1ZSBkZWZpbmEgbG9zIG3DqXRvZG9zIHF1ZSB2YW1vcyBhIG5lY2VzaXRhciB5IGx1ZWdvIGltcGxlbWVudGFtb3MgZXN0YSBpbnRlcmZheiBlbiBsYXMgY2xhc2VzIGRlIGNhZGEgYmFuY28uCgppbnRlcmZhY2UgQmFuY29TZXJ2aWNlIHsKCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2lyYXIoJG1vbnRvKTsKCiAgICBwdWJsaWMgZnVuY3Rpb24gZGVwb3NpdGFyKCRtb250byk7CgogICAgcHVibGljIGZ1bmN0aW9uIGdldFNhbGRvKCk7Cn0KCkltcGxlbWVudGFtb3MgbGFzIGNsYXNlcyBkZSBjYWRhIGJhbmNvIGNvbiBsb3MgbcOpdG9kb3MgaW5kaWNhZG9zOgoKcHVibGljIGNsYXNzIEJjaVNlcnZpY2UgaW1wbGVtZW50cyBCYW5jb1NlcnZpY2UKewogICAgLi4uCn0KCnB1YmxpYyBjbGFzcyBCYW5jb0VzdGFkb1NlcnZpY2UgaW1wbGVtZW50cyBCYW5jb1NlcnZpY2UKewogICAgLi4uCn0KClkgbW9kaWZpY2Ftb3MgbnVlc3RyYSBjbGFzZSBwYXJhIHF1ZSB1c2UgbGFzIGRlcGVuZGVuY2lhcwoKY2xhc3MgTWlCYW5jbyB7CgogICAgcHJvdGVjdGVkICRiYW5jb1NlcnZpY2U7CgogICAgcHVibGljIGZ1bmN0aW9uIF9fY29uc3RydWN0KEJhbmNvU2VydmljZSAkYmFuY29TZXJ2aWNlKQogICAgewogICAgICAgICR0aGlzLT5iYW5jb1NlcnZpY2UgPSAkYmFuY29TZXJ2aWNlOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBoYWNlckdpcm8oJG1vbnRvKQogICAgeyAgICAgICAKICAgICAgICAkdGhpcy0+YmFuY29TZXJ2aWNlLT5naXJhcigkbW9udG8pOwogICAgICAgIHJldHVybiAkdGhpcy0+YmFuY29TZXJ2aWNlLT5nZXRTYWxkbygpOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBoYWNlckRlcG9zaXRvKCRtb250bykKICAgIHsgICAgICAgCiAgICAgICAgJHRoaXMtPmJhbmNvU2VydmljZS0+ZGVwb3NpdGFyKCRtb250byk7CiAgICAgICAgcmV0dXJuICR0aGlzLT5iYW5jb1NlcnZpY2UtPmdldFNhbGRvKCk7CiAgICB9Cn0KCkFob3JhIHBvZGVtb3MgdXNhciBlbCBzZXJ2aWNpbyBxdWUgbmVjZXNpdGVtb3MKCiRiYW5jb1NlcnZpY2UgPSBuZXcgQmFuY29Fc3RhZG9TZXJ2aWNlKCk7CiRtaUJhbmNvID0gbmV3IE1pQmFuY28oJGJhbmNvU2VydmljZSk7CiRtaUJhbmNvLT5oYWNlckRlcG9zaXRvKDEwMDApOwokbWlCYW5jby0+aGFjZXJHaXJvKDQwMCk7CgpXZXJrw6luIEJsb2cKCkRlYyAxNiwgMjAxNVZsYWRpbWlyIFp1cml0YQoKRWwgYmxvZyBxdWUgYWhvcmEgbWlzbW8gZXN0YXMgbGV5ZW5kbywgZXN0w6EgaGVjaG8gY29uIFdlcmvDqW4gQmxvZywgdW4gc2VuY2lsbG8gcHJveWVjdG8gaGVjaG8gZW4gUEhQIHVzYW5kbyBlbCBmcmFtZXdvcmsgTGFyYXZlbCA1LjEgeSBxdWUgcHVlZGVzIHZlciBlbiBodHRwczovL2dpdGh1Yi5jb20vdmxhZHp1ci93ZXJrZW4KCkF1bnF1ZSBhw7puIGVzdMOhIGVuIHN1IGV0YXBhIGFscGhhLCBzZSBwdWVkZSB1c2FyLCBjb21vIHF1ZWRhIGRlbW9zdHJhZG8gYXF1w60uCgpQYXJhIHVzYXJsbywgZGViZXMgc2VndWlyIGVzdG9zIHBhc29zOgoKJCBnaXQgY2xvbmUgaHR0cHM6Ly9naXRodWIuY29tL3ZsYWR6dXIvd2Vya2VuCiQgY2Qgd2Vya2VuCiQgY29tcG9zZXIgaW5zdGFsbAoKVW5hIHZleiByZWFsaXphZG8gZXN0bywgZGViZXMgY29uZmlndXJhciBsYSBhcGxpY2FjacOzbiB1c2FuZG8gZWwgYXJjaGl2byBkZSBjb25maWd1cmFjacOzbiAuZW52CgokIGNwIC5lbnYuZXhhbXBsZSAuZW52CgpDb25maWd1cmFyIGxvcyBkYXRvcyBkZSBjb25leGnDs24gYSBsYSBiYXNlIGRlIGRhdG9zIHkgbHVlZ28gZWplY3V0YXIgbG9zIGNvbWFuZG9zIGRlIGluaWNpYWxpemFjacOzbiBkZSBsYSBhcGxpY2FjacOzbjoKCiQgcGhwIGFydGlzYW4ga2V5OmdlbmVyYXRlCiQgJHBocCBhcnRpc2FuIG1pZ3JhdGUKJCBwaHAgYXJ0aXNhbiBkYjpzZWVkCgpBaG9yYSB5YSBwb2RlbW9zIHByb2JhciBudWVzdHJvIGJsb2cKCiQgcGhwIGFydGlzYW4gc2VydgoKQ29uIGVzdG8gbGV2YW50YW1vcyBlbCBzZXJ2aWRvciBkZSBwcnVlYmFzIGVuIGVsIHB1ZXJ0byA4MDAwLCBzaSBlbnRyYW1vcyBhIGh0dHA6Ly9sb2NhbGhvc3Q6ODAwMC9hdXRoL2xvZ2luIGNvbiBlc3RhcyBjcmVkZW5jaWFsZXM6CgpVU0VSOiBhZG1pbkBibG9nLmNvbSBQQVNTV09SRDogYWRtaW4KClkgYSBwcm9iYXIuCgpTb2JyZSBlc2NyaXR1cmEgZGUgbcOpdG9kb3MgZW4gUEhQCgpEZWMgMTYsIDIwMTVWbGFkaW1pciBadXJpdGEKClBIUCBwZXJtaXRlIGxhIHNvYnJlIGVzY3JpdHVyYSBkZSBtw6l0b2RvcywgcGVybyBubyBsYSBzb2JyZSBjYXJnYSwgZXN0byBlcyBtdXkgaW1wb3J0YW50ZSBkZSB0ZW5lciBlbiBjb25zaWRlcmFjacOzbi4KCkVuIFBIUCBzZSBwdWVkZSBzb2JyZSBlc2NyaWJpciB1biBtw6l0b2RvIGhlcmVkYWRvIHNpZW1wcmUgeSBjdWFuZG8gc2UgY3VtcGxhIGNvbiBsbyBzaWd1aWVudGU6CgogICAgRWwgbcOpdG9kbyBubyBzZWEgcHJpdmFkbwogICAgVGVuZ2EgbGEgbWlzbWEgY2FudGlkYWQgZGUgcGFyw6FtZXRyb3MKICAgIExvcyBwYXLDoW1ldHJvcyBvcGNpb25hbGVzIHNlYW4gbG9zIG1pc21vcwoKQXPDrSB0ZW5lbW9zIHBvciBlamVtcGxvOgoKY2xhc3MgVW5vCnsKICAgIHB1YmxpYyBmdW5jdGlvbiBpbXByaW1pcigkdGV4dG8pCiAgICB7CiAgICAgICAgZWNobyAkdGV4dG87CiAgICB9Cn0KCmNsYXNzIERvcyBleHRlbmRzIFVubwp7CiAgICBwdWJsaWMgZnVuY3Rpb24gaW1wcmltaXIoJHRleHRvKQogICAgewogICAgICAgIGVjaG8gInskdGV4dG99XG4iOwogICAgfQp9CgpQb2RlbW9zIHZlciBxdWUgZWwgbcOpdG9kbyBpbXByaW1pciBkZSBsYSBzZWd1bmRhIGNsYXNlIHNlIGRlY2xhcmEgaWd1YWwgcXVlIGVuIGxhIGNsYXNlIHBhZHJlLCBwZXJvIHN1IGltcGxlbWVudGFjacOzbiBlcyBkaWZlcmVudGUuCgpIYXkgcXVlIHRlbmVyIGVuIGN1ZW50YSBxdWUgZW4gUEhQIGxvcyBub21icmVzIGRlIGZ1bmNpb25lcyB5IG3DqXRvZG9zIHNvbiBjYXNlIGluc2Vuc2l0aXZlLCBwb3IgbG8gcXVlIHNlcsOhIGxvIG1pc21vIGRlY2xhcmFyIGVsIG3DqXRvZG8gSW1wcmltaXIoKSBvIGltcHJpbWlyKCku";
        $cypher = new Cifrador();
        $encrypted = $cypher->encrypt($text, 's3cr3tp4ssw0rd');
        $decrypted = $cypher->decrypt($encrypted, 's3cr3tp4ssw0rd');
        return $this->assertEquals($text, $decrypted);
    }
}
